<div class="p-6 bg-gray-50 flex-1">

  <div class="p-6 bg-white overflow-hidden shadow rounded-lg w-full h-full overflow-x-auto">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-semibold text-gray-800">Questions</h1>
        <p class="text-sm text-gray-500">Manage the questions and Options available on the platform.</p>
      </div>
      <p-button (onClick)="openEditModal()" label="New Question">
        <ng-template pTemplate="icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="text-white">
            <path fill="currentColor"
              d="M11 13H6q-.425 0-.712-.288T5 12t.288-.712T6 11h5V6q0-.425.288-.712T12 5t.713.288T13 6v5h5q.425 0 .713.288T19 12t-.288.713T18 13h-5v5q0 .425-.288.713T12 19t-.712-.288T11 18z"
              stroke-width="0.9" stroke="currentColor"></path>
          </svg>
        </ng-template>
      </p-button>
    </div>

    <app-question-admin-modal (refreshTrigger)="onRefresh()" [cognitiveCategories]="cognitiveCategories()!" [tests]="tests()!" />

    <p-table #dt [value]="questionsResource.value()!" [paginator]="true" [rows]="pageSize()"
      [totalRecords]="totalRecords" [lazy]="true" (onLazyLoad)="loadTestsLazy($event)"
      [alwaysShowPaginator]=" totalRecords > 0" (onFilter)="onTableFilter($event)" [loading]="loading()"
      [sortField]="sortField()" [sortOrder]="sortDescending() ? -1 : 1">

      <!-- HEADER -->
      <ng-template pTemplate="header">
        <tr>
          @for (colum of columns; track colum) {
          <th scope="col" pSortableColumn="{{colum.key}}"
            class="bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            {{colum.label}}
          </th>
          }
          <th scope="col"
            class="bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Actions
          </th>
        </tr>
      </ng-template>

      <!-- BODY -->
      <ng-template pTemplate="body" let-question>
        <tr class="hover:bg-gray-50 border-b border-gray-200 transition duration-200">

          <td class="px-6 py-4 align-top">
            <div class="text-sm text-gray-900 break-words max-w-[120px] md:max-w-[180px] whitespace-normal text-start">
              {{question.questionNumber}}
            </div>
          </td>

          <td class="px-6 py-4 align-top">
            <div class="flex items-start gap-3 max-w-md">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="flex-shrink-0 mt-1">
                <path
                  d="M14 19c3.771 0 5.657 0 6.828-1.172S22 14.771 22 11s0-5.657-1.172-6.828S17.771 3 14 3h-4C6.229 3 4.343 3 3.172 4.172S2 7.229 2 11s0 5.657 1.172 6.828c.653.654 1.528.943 2.828 1.07" />
                <path
                  d="M10 8.484C10.5 7.494 11 7 12 7c1.246 0 2 .989 2 1.978s-.5 1.033-2 2.022v1m0 2.5v.5m2 4c-1.236 0-2.598.5-3.841 1.145c-1.998 1.037-2.997 1.556-3.489 1.225s-.399-1.355-.212-3.404L6.5 17.5" />
              </svg>
              <span class="text-gray-900 text-base leading-relaxed break-words whitespace-normal flex-1">
                {{ question.text }}
              </span>
            </div>
          </td>



          <!-- Tipo de pregunta -->
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div [ngClass]="{
            'bg-purple-100 text-purple-600': question.type === QuestionType.SingleChoice,
            'bg-indigo-100 text-indigo-600': question.type === QuestionType.MultipleChoice || question.type === QuestionType.OpenEnded,
            'bg-red-100 text-red-600': question.type === QuestionType.TrueFalse
          }" class="flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-full">
                <div class="w-5 h-5 flex items-center justify-center">
                  @switch (question.type) {
                  @case (QuestionType.SingleChoice) {
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor"
                      d="M11.75 6c1.349 0 2.18.969 2.246 2.329l.004.18v2.115l2.22.403q.129.024.258.058a3.25 3.25 0 0 1 2.343 3.799l-.042.18l-1.048 3.922a2.25 2.25 0 0 1-1.69 1.617l-.165.03l-2.418.347a2.25 2.25 0 0 1-2.28-1.124l-.08-.154l-.029-.063a3.46 3.46 0 0 0-1.026-1.283l-.193-.139l-1.884-1.255l-.094-.059l-.097-.052l-2.363-1.176a.75.75 0 0 1-.416-.655c-.025-1.108.466-1.963 1.419-2.44c.702-.351 1.635-.331 2.826.017l.26.079V8.508C9.5 7.055 10.342 6 11.75 6m0 1.5c-.46 0-.712.275-.746.866L11 8.508v5.244a.75.75 0 0 1-1.036.694c-1.46-.603-2.441-.743-2.878-.524c-.254.127-.42.29-.51.518l-.038.12l1.905.948l.18.097l.175.108l1.884 1.256a5 5 0 0 1 1.626 1.793l.122.244l.029.063a.75.75 0 0 0 .678.434l.108-.008l2.418-.347a.75.75 0 0 0 .582-.444l.036-.105l1.049-3.923a1.75 1.75 0 0 0-1.24-2.142l-.069-.017l-2.905-.53a.75.75 0 0 1-.608-.63l-.008-.107V8.508c0-.69-.254-1.008-.75-1.008m0-5a5.75 5.75 0 0 1 5.393 7.749l-.144-.053a6 6 0 0 0-.608-.175a5 5 0 0 0-.727-.112A4.25 4.25 0 1 0 8.5 10.99a6 6 0 0 0-.824.123c-.351.085-.588.17-.752.263A5.75 5.75 0 0 1 11.749 2.5" />
                  </svg>
                  }
                  @case (QuestionType.MultipleChoice) {
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor"
                      d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0-4 0m0-6a2 2 0 1 0 4 0a2 2 0 0 0-4 0m0 12a2 2 0 1 0 4 0a2 2 0 0 0-4 0" />
                  </svg>
                  }
                  @case (QuestionType.OpenEnded) {
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor"
                      d="M12.002 4v6.251a.75.75 0 0 1-1.5 0V5.226a.493.493 0 0 0-.498-.478a.527.527 0 0 0-.504.504v7.499a.75.75 0 0 1-1.295.515v-.001l-.004-.003l-.022-.022l-.102-.096a4 4 0 0 0-.401-.32c-.352-.25-.81-.496-1.303-.582c-.537-.095-1.047-.037-1.385.138a.82.82 0 0 0-.446.528l1.659 1.247a1 1 0 0 1 .08.068l2.174 2.173a12.3 12.3 0 0 1 2.303 3.193c.178.355.473.627.825.778l-.438 1.44a3.15 3.15 0 0 1-1.729-1.548a10.8 10.8 0 0 0-2.02-2.802l-2.14-2.137L3.3 13.85a.75.75 0 0 1-.299-.6c0-1.06.531-1.806 1.3-2.203c.715-.37 1.582-.414 2.332-.283c.519.091.983.284 1.368.495V5.252c0-1.06.888-2.01 2.013-2.003c.212 0 .413.034.6.093A1.98 1.98 0 0 1 12.503 2c.915 0 1.622.586 1.885 1.341q.286-.091.612-.092c1.108 0 1.896.855 1.987 1.817q.243-.063.512-.064c1.17 0 2.001.96 2.001 2v4.312a6.5 6.5 0 0 0-1.5-.295V7.002a.5.5 0 0 0-.501-.5a.5.5 0 0 0-.503.5v3.5a.75.75 0 0 1-.23.539q-.42.046-.822.147a.75.75 0 0 1-.448-.687V5.252A.495.495 0 0 0 15 4.748c-.287 0-.5.226-.5.504v5a.75.75 0 0 1-1.5 0V3.998c0-.272-.212-.5-.499-.5a.49.49 0 0 0-.5.5m5.969 8.02A5.5 5.5 0 0 1 21 13.256a5.501 5.501 0 0 1-6.166 9.058l-2.187.666a.5.5 0 0 1-.624-.625l.666-2.186a5.501 5.501 0 0 1 5.282-8.149M15 16.5a.5.5 0 0 0 .5.5h4a.5.5 0 1 0 0-1h-4a.5.5 0 0 0-.5.5m.5 2.5h2a.5.5 0 1 0 0-1h-2a.5.5 0 1 0 0 1" />
                  </svg>
                  }
                  @default{
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                      stroke-width="2">
                      <path d="M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344" />
                      <path d="m9 11l3 3L22 4" />
                    </g>
                  </svg>
                  }
                  }
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm text-gray-900">{{QuestionType[question.type] | camelCaseToSpaces}}</div>
              </div>
            </div>
          </td>


          <td class="px-6 py-4 align-top">
            <div
              class="text-sm text-gray-900 break-words max-w-[250px] md:max-w-md lg:max-w-lg whitespace-normal text-start">
              {{question.testName}}
            </div>
          </td>
          <td class="px-6 py-4 align-top">
            <div
              class="text-sm text-gray-900 break-words max-w-[250px] md:max-w-md lg:max-w-lg whitespace-normal text-start">
              {{question.cognitiveCategoryName}}
            </div>
          </td>

          <!-- Puntaje -->
          <td class="px-6 py-4 align-top text-center">
            <span
              class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-800 text-sm font-semibold select-none">
              {{ question.score }}
            </span>
          </td>


          <td class="px-6 py-4 text-right text-sm font-medium">
            <div class="relative inline-block text-left">
              <div class="flex-shrink-0 ml-4 flex space-x-2">
                <button class="w-11 h-11 flex items-center justify-center text-gray-400 hover:text-gray-500 rounded hover:bg-indigo-100"
                  (click)="openEditModal(question)" aria-label="Editar test">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="w-6 h-6">
                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                      stroke-width="2">
                      <path stroke-dasharray="20" stroke-dashoffset="20" d="M3 21h18">
                        <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="20;0" />
                      </path>
                      <path stroke-dasharray="48" stroke-dashoffset="48" d="M7 17v-4l10 -10l4 4l-10 10h-4">
                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.2s" dur="0.6s"
                          values="48;0" />
                      </path>
                      <path stroke-dasharray="8" stroke-dashoffset="8" d="M14 6l4 4">
                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.2s" values="8;0" />
                      </path>
                    </g>
                  </svg>
                </button>
                <button (click)="openDeleteModal(question.id)"
                  class="w-11 h-11 flex items-center justify-center text-gray-400 hover:text-gray-500 rounded hover:bg-red-100"
                  aria-label="Otro botón">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="w-6 h-6">
                    <path fill="currentColor"
                      d="M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zm-7 11q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17M7 6v13z" />
                  </svg>
                </button>
              </div>
            </div>
          </td>
        </tr>

      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="columns.length + 1">
            <div class="flex flex-col items-center justify-center py-12 text-gray-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mb-4 text-gray-300" fill="none"
                viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 17v-2a4 4 0 00-4-4H3m18 4a4 4 0 00-4-4h-2m-2-4a4 4 0 00-8 0m8 0a4 4 0 018 0m-8 0v1m0 4v4m-4 0h8" />
              </svg>
              <p class="text-lg font-semibold mb-2">No questions found</p>
              <p class="text-sm">Try adjusting your filters or click "New Question" to get started.</p>
            </div>
          </td>
        </tr>
      </ng-template>

    </p-table>

    <p-toast />

    <app-delete-confirm-dialog [entityName]="'Question'" [deleteService]="questionService" (completed)="onRefresh()"
      (cancel)="cancelDeleteModal()"></app-delete-confirm-dialog>
  </div>
</div>
