<div class="flex justify-between items-center mb-6">
  <div>
    <h1 class="text-2xl font-semibold text-gray-800">Questions</h1>
    <p class="text-sm text-gray-500">Manage the questions and Options available on the platform.</p>
  </div>
  <p-button (onClick)="openEditModal()" label="New Question">
    <ng-template pTemplate="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="text-white">
        <path fill="currentColor"
          d="M11 13H6q-.425 0-.712-.288T5 12t.288-.712T6 11h5V6q0-.425.288-.712T12 5t.713.288T13 6v5h5q.425 0 .713.288T19 12t-.288.713T18 13h-5v5q0 .425-.288.713T12 19t-.712-.288T11 18z"
          stroke-width="0.9" stroke="currentColor"></path>
      </svg>
    </ng-template>
  </p-button>
</div>

<app-admin-test-modal (refreshTrigger)="onRefresh()" />

<p-table #dt [value]="questionsResource.value()!" [paginator]="true" [rows]="pageSize()" [totalRecords]="totalRecords"
  [lazy]="true" (onLazyLoad)="loadTestsLazy($event)" (onFilter)="onTableFilter($event)" [loading]="loading()"
  [sortField]="sortField()" [sortOrder]="sortDescending() ? -1 : 1">

  <!-- HEADER -->
  <ng-template pTemplate="header">
    <tr>
      @for (colum of columns; track colum) {
      <th scope="col" pSortableColumn="{{colum.key}}"
        class="bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        {{colum.label}}
      </th>
      }
      <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        Actions
      </th>
    </tr>
  </ng-template>

  <!-- BODY -->
  <ng-template pTemplate="body" let-question>
    <tr class="table-row cursor-pointer">

      <td class="px-6 py-4 align-top">
        <div class="text-sm text-gray-900 break-words max-w-xs whitespace-normal text-start">
          {{question.questionNumber}}
        </div>
      </td>
      <td class="px-6 py-4 align-top">
        <div class="text-sm text-gray-900 break-words max-w-xs whitespace-normal text-start">
          {{question.text}}
        </div>
      </td>

      <td class="px-6 py-4 whitespace-nowrap">
        <div class="flex items-center">
          <div [ngClass]="{
            'bg-indigo-100 text-indigo-600': question.type === TestType.IQ,
            'bg-purple-100 text-purple-600': question.type === TestType.Personality || question.type === TestType.Other,
            'bg-red-100 text-red-600': question.type === TestType.Skills
          }" class="flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-full">
            <div class="w-5 h-5 flex items-center justify-center">
              @switch (question.type) {
              @case (TestType.IQ) {
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24">
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4">
                  <path d="M12 5a3 3 0 1 0-5.997.125a4 4 0 0 0-2.526 5.77a4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z" />
                  <path d="M12 5a3 3 0 1 1 5.997.125a4 4 0 0 1 2.526 5.77a4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z" />
                  <path
                    d="M15 13a4.5 4.5 0 0 1-3-4a4.5 4.5 0 0 1-3 4m8.599-6.5a3 3 0 0 0 .399-1.375m-11.995 0A3 3 0 0 0 6.401 6.5m-2.924 4.396a4 4 0 0 1 .585-.396m15.876 0a4 4 0 0 1 .585.396M6 18a4 4 0 0 1-1.967-.516m15.934 0A4 4 0 0 1 18 18" />
                </g>
              </svg>
              }
              @case (TestType.Personality) {
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" stroke-width="2">
                <path fill="currentColor"
                  d="M6 22v-4.3q-1.425-1.3-2.212-3.037T3 11q0-3.75 2.625-6.375T12 2q3.125 0 5.538 1.838t3.137 4.787l1.3 5.125q.125.475-.175.863T21 15h-2v3q0 .825-.587 1.413T17 20h-2v2h-2v-4h4v-5h2.7l-.95-3.875q-.575-2.275-2.45-3.7T12 4Q9.1 4 7.05 6.025T5 10.95q0 1.5.613 2.85t1.737 2.4l.65.6V22zm6-6q.425 0 .713-.288T13 15t-.288-.712T12 14t-.712.288T11 15t.288.713T12 16m-.75-3.2h1.525q0-.625.163-1.012t.662-.938q.45-.5.875-1.012T14.9 8.5q0-1.05-.812-1.775T12.075 6q-1 0-1.812.575t-1.138 1.5l1.375.575q.175-.55.613-.888t.962-.337q.55 0 .913.3t.362.775q0 .525-.312.938t-.738.837q-.5.525-.775 1.05T11.25 12.8" />
              </svg>
              }
              @case (TestType.Skills) {
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" stroke-width="2">
                <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="1.5"
                  d="M12 9.8V20m0-10.2c0-1.704.107-3.584-1.638-4.473C9.72 5 8.88 5 7.2 5H4.6C3.364 5 3 5.437 3 6.6v8.8c0 .568-.036 1.195.546 1.491c.214.109.493.109 1.052.109H7.43c2.377 0 3.26 1.036 4.569 3m0-10.2c0-1.704-.108-3.584 1.638-4.473C14.279 5 15.12 5 16.8 5h2.6c1.235 0 1.6.436 1.6 1.6v8.8c0 .567.035 1.195-.546 1.491c-.213.109-.493.109-1.052.109h-2.833c-2.377 0-3.26 1.036-4.57 3" />
              </svg>
              }
              @default{
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="20" fill="none" stroke="currentColor" stroke-width="4" />
              </svg>
              }
              }
            </div>
          </div>
          <div class="ml-4">
            <div class="text-sm text-gray-900">{{TestType[question.type]}}</div>
          </div>
        </div>
      </td>
      <td class="px-6 py-4 align-top">
        <div class="text-sm text-gray-900 break-words max-w-xs whitespace-normal text-start">
          {{question.testId}}
        </div>
      </td>
      <td class="px-6 py-4 align-top">
        <div class="text-sm text-gray-900 break-words max-w-xs whitespace-normal text-start">
          {{question.type}}
        </div>
      </td>
      <td class="px-6 py-4 align-top">
        <div class="text-sm text-gray-900 break-words max-w-xs whitespace-normal text-start">
          {{question.score}}
        </div>
      </td>


      <td class="px-6 py-4 text-right text-sm font-medium">
        <div class="relative inline-block text-left">
          <div class="flex-shrink-0 ml-4 flex space-x-2">
            <button class="w-11 h-11 flex items-center justify-center text-gray-400 hover:text-gray-500 rounded"
              (click)="openEditModal(question)" aria-label="Editar test">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="w-6 h-6">
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                  <path stroke-dasharray="20" stroke-dashoffset="20" d="M3 21h18">
                    <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="20;0" />
                  </path>
                  <path stroke-dasharray="48" stroke-dashoffset="48" d="M7 17v-4l10 -10l4 4l-10 10h-4">
                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.2s" dur="0.6s" values="48;0" />
                  </path>
                  <path stroke-dasharray="8" stroke-dashoffset="8" d="M14 6l4 4">
                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.2s" values="8;0" />
                  </path>
                </g>
              </svg>
            </button>
            <button (click)="openDeleteModal(question.id)"
              class="w-11 h-11 flex items-center justify-center text-gray-400 hover:text-gray-500 rounded"
              aria-label="Otro botÃ³n">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="w-6 h-6">
                <path fill="currentColor"
                  d="M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zm-7 11q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17M7 6v13z" />
              </svg>
            </button>
          </div>
        </div>
      </td>

    </tr>
  </ng-template>


</p-table>

<p-toast />

<app-delete-confirm-dialog [entityName]="'Question'" [deleteService]="questionService" (completed)="onRefresh()"
  (cancel)="cancelDeleteModal()"></app-delete-confirm-dialog>
